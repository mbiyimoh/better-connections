generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                    String    @id @default(uuid())
  email                 String    @unique
  name                  String

  // Preferences
  emailNotifications    Boolean   @default(true)
  weeklyDigest          Boolean   @default(true)
  enrichmentReminders   Boolean   @default(false)

  // Metadata
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  lastLoginAt           DateTime?

  // Relations
  contacts              Contact[]
}

model Contact {
  id                    String    @id @default(uuid())
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Name fields
  firstName             String    @default("")
  lastName              String?

  // Email fields
  primaryEmail          String?
  secondaryEmail        String?

  // Phone fields
  primaryPhone          String?
  secondaryPhone        String?

  // Basic Info
  title                 String?
  company               String?
  linkedinUrl           String?
  websiteUrl            String?   // Portfolio, blog, or company profile page

  // Address fields (Google-style breakdown)
  streetAddress         String?
  city                  String?
  state                 String?
  zipCode               String?
  country               String?
  location              String?   // Legacy: formatted location or city fallback

  // Referral
  referredBy            String?   // Who introduced/connected you to this person

  // Relationship Context
  howWeMet              String?   @db.Text
  relationshipStrength  Int       @default(1) // 1=Weak, 2=Casual, 3=Good, 4=Strong
  lastContactDate       DateTime?
  relationshipHistory   String?   @db.Text

  // Why Now (Key Differentiator)
  whyNow                String?   @db.Text

  // Profile
  expertise             String?   @db.Text
  interests             String?   @db.Text
  notes                 String?   @db.Text

  // Metadata
  enrichmentScore       Int       @default(0) // 0-100
  source                ContactSource @default(MANUAL)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  lastEnrichedAt        DateTime?

  // Relations
  tags                  Tag[]

  @@index([userId])
  @@index([firstName])
  @@index([lastName])
  @@index([primaryEmail])
  @@index([enrichmentScore])
}

model Tag {
  id        String      @id @default(uuid())
  contactId String
  contact   Contact     @relation(fields: [contactId], references: [id], onDelete: Cascade)
  text      String
  category  TagCategory

  @@index([contactId])
}

enum ContactSource {
  MANUAL
  CSV
  GOOGLE
  LINKEDIN
  ICLOUD
  OUTLOOK
}

enum TagCategory {
  RELATIONSHIP
  OPPORTUNITY
  EXPERTISE
  INTEREST
}
